---
buildifier:
  version: 6.3.3

matrix:
  platform: ["windows", "ubuntu1804", "rbe_ubuntu1604", "macos"]
  working_directory: ["", "examples"]
  strict_deps: ["--@rules_dotnet//dotnet/settings:strict_deps=true", "--@rules_dotnet//dotnet/settings:strict_deps=false"]
  flag_combo: [["--enable_bzlmod", "--@rules_dotnet//dotnet/settings:strict_deps=true"], ["--enable_bzlmod", "--@rules_dotnet//dotnet/settings:strict_deps=false"], ["--noenable_bzlmod", "--@rules_dotnet//dotnet/settings:strict_deps=true"], ["--noenable_bzlmod", "--@rules_dotnet//dotnet/settings:strict_deps=false"]]

tasks:
  test_all:
    name: Build and test
    platform: ${{ platform }}
    working_directory: ${{ working_directory }}
    include_json_profile:
      - build
      - test
    build_targets:
      - "//..."
    test_targets:
      - "//..."
    build_flags: ${{ flag_combo }}
    test_flags: ${{ flag_combo }}
