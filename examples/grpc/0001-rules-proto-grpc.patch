From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: mjs-rokt <marc.szalkiewicz@rokt.com>
Date: Tue, 25 Jan 2022 19:01:19 -0500
Subject: [PATCH] Add .NET 6.0 dependencies.


diff --git a/csharp/nuget/nuget.bzl b/csharp/nuget/nuget.bzl
index 2e104b12..d1fc0338 100644
--- a/csharp/nuget/nuget.bzl
+++ b/csharp/nuget/nuget.bzl
@@ -43,6 +43,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "netcoreapp3.1": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "net5.0": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
+            "net6.0": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
         },
         core_ref = {
             "netcoreapp2.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
@@ -51,6 +52,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "netcoreapp3.1": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "net5.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
+            "net6.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
         },
         core_files = {
             "netcoreapp2.0": [
@@ -77,6 +79,10 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
                 "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.xml",
             ],
+            "net6.0": [
+                "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
+                "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.xml",
+            ],
         },
     )
     nuget_package(
@@ -111,6 +117,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Google.Protobuf.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Google.Protobuf.dll",
             "net5.0": "lib/net5.0/Google.Protobuf.dll",
+            "net6.0": "lib/net5.0/Google.Protobuf.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -165,13 +172,18 @@ def nuget_rules_proto_grpc_packages():
                 "lib/net5.0/Google.Protobuf.pdb",
                 "lib/net5.0/Google.Protobuf.xml",
             ],
+            "net6.0": [
+                "lib/net5.0/Google.Protobuf.dll",
+                "lib/net5.0/Google.Protobuf.pdb",
+                "lib/net5.0/Google.Protobuf.xml",
+            ],
         },
     )
     nuget_package(
         name = "grpc.core.api",
         package = "grpc.core.api",
-        version = "2.42.0",
-        sha256 = "e8c12e9d1e4dddbce1d4ea1c7c27f3599c94d5ad18e5ef08c836de02d94f0d07",
+        version = "2.43.0",
+        sha256 = "12880d33af4b2706b009c09ce67a087520c0c23f7fb71fedf0eedb088e68dc2b",
         core_lib = {
             "netcoreapp2.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
             "netcoreapp2.1": "lib/netstandard2.0/Grpc.Core.Api.dll",
@@ -179,6 +191,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Grpc.Core.Api.dll",
             "net5.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
+            "net6.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -199,6 +212,9 @@ def nuget_rules_proto_grpc_packages():
             "net5.0": [
                 "@system.memory//:net5.0_core",
             ],
+            "net6.0": [
+                "@system.memory//:net6.0_core",
+            ],
         },
         core_files = {
             "netcoreapp2.0": [
@@ -231,13 +247,18 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netstandard2.0/Grpc.Core.Api.pdb",
                 "lib/netstandard2.0/Grpc.Core.Api.xml",
             ],
+            "net6.0": [
+                "lib/netstandard2.0/Grpc.Core.Api.dll",
+                "lib/netstandard2.0/Grpc.Core.Api.pdb",
+                "lib/netstandard2.0/Grpc.Core.Api.xml",
+            ],
         },
     )
     nuget_package(
         name = "grpc.core",
         package = "grpc.core",
-        version = "2.42.0",
-        sha256 = "7180cc7b1cdc5f60885e2a17f2ecc5dcdb9eb737f917214309c1eb04e0d8e4cb",
+        version = "2.43.0",
+        sha256 = "bd4ee0a45e86d381df853999792185d219c6fab72975666ad58db304522efba7",
         core_lib = {
             "netcoreapp2.0": "lib/netstandard2.0/Grpc.Core.dll",
             "netcoreapp2.1": "lib/netstandard2.0/Grpc.Core.dll",
@@ -245,6 +266,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Grpc.Core.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Grpc.Core.dll",
             "net5.0": "lib/netstandard2.0/Grpc.Core.dll",
+            "net6.0": "lib/netstandard2.0/Grpc.Core.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -271,6 +293,10 @@ def nuget_rules_proto_grpc_packages():
                 "@grpc.core.api//:net5.0_core",
                 "@system.memory//:net5.0_core",
             ],
+            "net6.0": [
+                "@grpc.core.api//:net6.0_core",
+                "@system.memory//:net6.0_core",
+            ],
         },
         core_files = {
             "netcoreapp2.0": [
@@ -343,6 +369,19 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netstandard2.0/Grpc.Core.pdb",
                 "lib/netstandard2.0/Grpc.Core.xml",
 
+                # Patched in by regenerate_packages.sh
+                # Can't use select() here, so must just specify all
+                "runtimes/win-x64/native/grpc_csharp_ext.x64.dll",
+                "runtimes/win-x86/native/grpc_csharp_ext.x86.dll",
+                "runtimes/linux-arm64/native/libgrpc_csharp_ext.arm64.so",
+                "runtimes/linux-x64/native/libgrpc_csharp_ext.x64.so",
+                "runtimes/osx-x64/native/libgrpc_csharp_ext.x64.dylib",
+            ],
+            "net6.0": [
+                "lib/netstandard2.0/Grpc.Core.dll",
+                "lib/netstandard2.0/Grpc.Core.pdb",
+                "lib/netstandard2.0/Grpc.Core.xml",
+
                 # Patched in by regenerate_packages.sh
                 # Can't use select() here, so must just specify all
                 "runtimes/win-x64/native/grpc_csharp_ext.x64.dll",
@@ -377,6 +416,9 @@ def nuget_rules_proto_grpc_packages():
             "net5.0": [
                 "@grpc.core//:net5.0_core",
             ],
+            "net6.0": [
+                "@grpc.core//:net6.0_core",
+            ],
         },
     )
     ### End of generated by the tool
diff --git a/csharp/nuget/regenerate_packages.sh b/csharp/nuget/regenerate_packages.sh
index f70f5bfc..807afc98 100755
--- a/csharp/nuget/regenerate_packages.sh
+++ b/csharp/nuget/regenerate_packages.sh
@@ -12,7 +12,8 @@ GRPC_VERSION="2.42.0"
 
 OUTPUT_DIR="$(pwd)/csharp/nuget"
 FILE_NAME="nuget.bzl"
-TOOL="bazel run --host_platform=@io_bazel_rules_dotnet//dotnet/toolchain:linux_amd64_5.0.201 --platforms=@io_bazel_rules_dotnet//dotnet/toolchain:linux_amd64_5.0.201 @io_bazel_rules_dotnet//tools/nuget2bazel:nuget2bazel.exe --"
+DOTNET_TOOLCHAIN="$(uname -sm | tr 'A-Z ' 'a-z_')_6.0.101"
+TOOL="bazel run --host_platform=@io_bazel_rules_dotnet//dotnet/toolchain:${DOTNET_TOOLCHAIN} --platforms=@io_bazel_rules_dotnet//dotnet/toolchain:${DOTNET_TOOLCHAIN} @io_bazel_rules_dotnet//tools/nuget2bazel:nuget2bazel.exe --"
 
 # Clear output files
 if [ -f "${OUTPUT_DIR}/${FILE_NAME}" ]; then
diff --git a/fsharp/nuget/nuget.bzl b/fsharp/nuget/nuget.bzl
index ef13102d..587d2bf3 100644
--- a/fsharp/nuget/nuget.bzl
+++ b/fsharp/nuget/nuget.bzl
@@ -43,6 +43,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "netcoreapp3.1": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "net5.0": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
+            "net6.0": "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
         },
         core_ref = {
             "netcoreapp2.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
@@ -51,6 +52,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "netcoreapp3.1": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
             "net5.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
+            "net6.0": "ref/netstandard2.0/System.Runtime.CompilerServices.Unsafe.dll",
         },
         core_files = {
             "netcoreapp2.0": [
@@ -77,6 +79,10 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
                 "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.xml",
             ],
+            "net6.0": [
+                "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.dll",
+                "lib/netcoreapp2.0/System.Runtime.CompilerServices.Unsafe.xml",
+            ],
         },
     )
     nuget_package(
@@ -111,6 +117,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Google.Protobuf.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Google.Protobuf.dll",
             "net5.0": "lib/net5.0/Google.Protobuf.dll",
+            "net6.0": "lib/net5.0/Google.Protobuf.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -165,13 +172,18 @@ def nuget_rules_proto_grpc_packages():
                 "lib/net5.0/Google.Protobuf.pdb",
                 "lib/net5.0/Google.Protobuf.xml",
             ],
+            "net6.0": [
+                "lib/net5.0/Google.Protobuf.dll",
+                "lib/net5.0/Google.Protobuf.pdb",
+                "lib/net5.0/Google.Protobuf.xml",
+            ],
         },
     )
     nuget_package(
         name = "grpc.core.api",
         package = "grpc.core.api",
-        version = "2.42.0",
-        sha256 = "e8c12e9d1e4dddbce1d4ea1c7c27f3599c94d5ad18e5ef08c836de02d94f0d07",
+        version = "2.43.0",
+        sha256 = "12880d33af4b2706b009c09ce67a087520c0c23f7fb71fedf0eedb088e68dc2b",
         core_lib = {
             "netcoreapp2.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
             "netcoreapp2.1": "lib/netstandard2.0/Grpc.Core.Api.dll",
@@ -179,6 +191,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Grpc.Core.Api.dll",
             "net5.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
+            "net6.0": "lib/netstandard2.0/Grpc.Core.Api.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -199,6 +212,9 @@ def nuget_rules_proto_grpc_packages():
             "net5.0": [
                 "@system.memory//:net5.0_core",
             ],
+            "net6.0": [
+                "@system.memory//:net6.0_core",
+            ],
         },
         core_files = {
             "netcoreapp2.0": [
@@ -231,13 +247,18 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netstandard2.0/Grpc.Core.Api.pdb",
                 "lib/netstandard2.0/Grpc.Core.Api.xml",
             ],
+            "net6.0": [
+                "lib/netstandard2.0/Grpc.Core.Api.dll",
+                "lib/netstandard2.0/Grpc.Core.Api.pdb",
+                "lib/netstandard2.0/Grpc.Core.Api.xml",
+            ],
         },
     )
     nuget_package(
         name = "grpc.core",
         package = "grpc.core",
-        version = "2.42.0",
-        sha256 = "7180cc7b1cdc5f60885e2a17f2ecc5dcdb9eb737f917214309c1eb04e0d8e4cb",
+        version = "2.43.0",
+        sha256 = "bd4ee0a45e86d381df853999792185d219c6fab72975666ad58db304522efba7",
         core_lib = {
             "netcoreapp2.0": "lib/netstandard2.0/Grpc.Core.dll",
             "netcoreapp2.1": "lib/netstandard2.0/Grpc.Core.dll",
@@ -245,6 +266,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Grpc.Core.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Grpc.Core.dll",
             "net5.0": "lib/netstandard2.0/Grpc.Core.dll",
+            "net6.0": "lib/netstandard2.0/Grpc.Core.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -271,6 +293,10 @@ def nuget_rules_proto_grpc_packages():
                 "@grpc.core.api//:net5.0_core",
                 "@system.memory//:net5.0_core",
             ],
+            "net6.0": [
+                "@grpc.core.api//:net6.0_core",
+                "@system.memory//:net6.0_core",
+            ],
         },
         core_files = {
             "netcoreapp2.0": [
@@ -343,6 +369,19 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netstandard2.0/Grpc.Core.pdb",
                 "lib/netstandard2.0/Grpc.Core.xml",
 
+                # Patched in by regenerate_packages.sh
+                # Can't use select() here, so must just specify all
+                "runtimes/win-x64/native/grpc_csharp_ext.x64.dll",
+                "runtimes/win-x86/native/grpc_csharp_ext.x86.dll",
+                "runtimes/linux-arm64/native/libgrpc_csharp_ext.arm64.so",
+                "runtimes/linux-x64/native/libgrpc_csharp_ext.x64.so",
+                "runtimes/osx-x64/native/libgrpc_csharp_ext.x64.dylib",
+            ],
+            "net6.0": [
+                "lib/netstandard2.0/Grpc.Core.dll",
+                "lib/netstandard2.0/Grpc.Core.pdb",
+                "lib/netstandard2.0/Grpc.Core.xml",
+
                 # Patched in by regenerate_packages.sh
                 # Can't use select() here, so must just specify all
                 "runtimes/win-x64/native/grpc_csharp_ext.x64.dll",
@@ -377,6 +416,9 @@ def nuget_rules_proto_grpc_packages():
             "net5.0": [
                 "@grpc.core//:net5.0_core",
             ],
+            "net6.0": [
+                "@grpc.core//:net6.0_core",
+            ],
         },
     )
     nuget_package(
@@ -391,6 +433,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/cs/FSharp.Core.resources.dll",
             "netcoreapp3.1": "lib/netstandard2.0/cs/FSharp.Core.resources.dll",
             "net5.0": "lib/netstandard2.0/cs/FSharp.Core.resources.dll",
+            "net6.0": "lib/netstandard2.0/cs/FSharp.Core.resources.dll",
         },
         core_files = {
             "netcoreapp2.0": [
@@ -495,6 +538,23 @@ def nuget_rules_proto_grpc_packages():
                 "lib/netstandard2.0/zh-Hans/FSharp.Core.resources.dll",
                 "lib/netstandard2.0/zh-Hant/FSharp.Core.resources.dll",
             ],
+            "net6.0": [
+                "lib/netstandard2.0/cs/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/de/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/es/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/fr/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/FSharp.Core.dll",
+                "lib/netstandard2.0/FSharp.Core.xml",
+                "lib/netstandard2.0/it/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/ja/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/ko/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/pl/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/pt-BR/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/ru/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/tr/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/zh-Hans/FSharp.Core.resources.dll",
+                "lib/netstandard2.0/zh-Hant/FSharp.Core.resources.dll",
+            ],
         },
     )
     nuget_package(
@@ -509,6 +569,7 @@ def nuget_rules_proto_grpc_packages():
             "netcoreapp3.0": "lib/netstandard2.0/Protobuf.FSharp.dll",
             "netcoreapp3.1": "lib/netstandard2.0/Protobuf.FSharp.dll",
             "net5.0": "lib/netstandard2.0/Protobuf.FSharp.dll",
+            "net6.0": "lib/netstandard2.0/Protobuf.FSharp.dll",
         },
         core_deps = {
             "netcoreapp2.0": [
@@ -535,6 +596,10 @@ def nuget_rules_proto_grpc_packages():
                 "@fsharp.core//:net5.0_core",
                 "@google.protobuf//:net5.0_core",
             ],
+            "net6.0": [
+                "@fsharp.core//:net6.0_core",
+                "@google.protobuf//:net6.0_core",
+            ],
         },
         core_files = {
             "netcoreapp2.0": [
@@ -555,6 +620,9 @@ def nuget_rules_proto_grpc_packages():
             "net5.0": [
                 "lib/netstandard2.0/Protobuf.FSharp.dll",
             ],
+            "net6.0": [
+                "lib/netstandard2.0/Protobuf.FSharp.dll",
+            ],
         },
     )
 
diff --git a/fsharp/nuget/nuget2config.json b/fsharp/nuget/nuget2config.json
index e30292e8..c9b9e476 100644
--- a/fsharp/nuget/nuget2config.json
+++ b/fsharp/nuget/nuget2config.json
@@ -6,8 +6,8 @@
     "System.Runtime.CompilerServices.Unsafe": "4.7.1",
     "System.Memory": "4.5.4",
     "Google.Protobuf": "3.19.1",
-    "Grpc.Core.Api": "2.42.0",
-    "Grpc.Core": "2.42.0",
+    "Grpc.Core.Api": "2.43.0",
+    "Grpc.Core": "2.43.0",
     "Grpc": "2.42.0",
     "FSharp.Core": "5.0.1",
     "Protobuf.FSharp": "0.1.3"
diff --git a/fsharp/nuget/regenerate_packages.sh b/fsharp/nuget/regenerate_packages.sh
index e06f52ab..77372261 100755
--- a/fsharp/nuget/regenerate_packages.sh
+++ b/fsharp/nuget/regenerate_packages.sh
@@ -15,7 +15,8 @@ FSHARP_CORE_VERSION="5.0.1"
 
 OUTPUT_DIR="$(pwd)/fsharp/nuget"
 FILE_NAME="nuget.bzl"
-TOOL="bazel run --host_platform=@io_bazel_rules_dotnet//dotnet/toolchain:linux_amd64_5.0.201 --platforms=@io_bazel_rules_dotnet//dotnet/toolchain:linux_amd64_5.0.201 @io_bazel_rules_dotnet//tools/nuget2bazel:nuget2bazel.exe --"
+DOTNET_TOOLCHAIN="$(uname -sm | tr 'A-Z ' 'a-z_')_6.0.101"
+TOOL="bazel run --host_platform=@io_bazel_rules_dotnet//dotnet/toolchain:${DOTNET_TOOLCHAIN} --platforms=@io_bazel_rules_dotnet//dotnet/toolchain:${DOTNET_TOOLCHAIN} @io_bazel_rules_dotnet//tools/nuget2bazel:nuget2bazel.exe --"
 
 # Clear output files
 if [ -f "${OUTPUT_DIR}/${FILE_NAME}" ]; then
diff --git a/repositories.bzl b/repositories.bzl
index baa1caa8..b129517d 100644
--- a/repositories.bzl
+++ b/repositories.bzl
@@ -112,8 +112,8 @@ VERSIONS = {
         "type": "github",
         "org": "bazelbuild",
         "repo": "rules_dotnet",
-        "ref": "a07119eedbba3aee95cefda1f4db0d6a48c53071",
-        "sha256": "75a9c7292e93a7c1b86f59cf457bea5c6e7d6899150e42dbb900ba755f1cbd84",
+        "ref": "d2d7340a140c9b9b03954879606a6e427361966c",
+        "sha256": "8ca5674ffcd657ca3928cb18824d45efa3f8256198a44f38b29820f5438200eb",
     },
 
     # D
-- 
2.34.1

